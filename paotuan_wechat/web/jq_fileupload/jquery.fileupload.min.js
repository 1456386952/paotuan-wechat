(function(a){if(typeof define==="function"&&define.amd){define(["jquery","jquery.ui.widget"],a)}else{a(window.jQuery)}}(function(a){a.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||a('<input type="file">').prop("disabled"));a.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);a.support.xhrFormDataFileUpload=!!window.FormData;a.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);function b(d){var c=d==="dragover";return function(g){g.dataTransfer=g.originalEvent&&g.originalEvent.dataTransfer;var f=g.dataTransfer;if(f&&a.inArray("Files",f.types)!==-1&&this._trigger(d,a.Event(d,{delegatedEvent:g}))!==false){g.preventDefault();if(c){f.dropEffect="copy"}}}}a.widget("blueimp.fileupload",{options:{dropZone:a(document),pasteZone:a(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(d,c){d=this.messages[d]||d.toString();if(c){a.each(c,function(e,f){d=d.replace("{"+e+"}",f)})}return d},formData:function(c){return c.serializeArray()},add:function(d,c){if(d.isDefaultPrevented()){return false}if(c.autoUpload||(c.autoUpload!==false&&a(this).fileupload("option","autoUpload"))){c.process().done(function(){c.submit()})}},processData:false,contentType:false,cache:false},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:a.support.blobSlice&&function(){var c=this.slice||this.webkitSlice||this.mozSlice;return c.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=((Date.now)?Date.now():(new Date()).getTime());this.loaded=0;this.bitrate=0;this.getBitrate=function(e,d,c){var f=e-this.timestamp;if(!this.bitrate||!c||f>c){this.bitrate=(d-this.loaded)*(1000/f)*8;this.loaded=d;this.timestamp=e}return this.bitrate}},_isXHRUpload:function(c){return !c.forceIframeTransport&&((!c.multipart&&a.support.xhrFileUpload)||a.support.xhrFormDataFileUpload)},_getFormData:function(d){var c;if(a.type(d.formData)==="function"){return d.formData(d.form)}if(a.isArray(d.formData)){return d.formData}if(a.type(d.formData)==="object"){c=[];a.each(d.formData,function(e,f){c.push({name:e,value:f})});return c}return[]},_getTotal:function(c){var d=0;a.each(c,function(f,e){d+=e.size||1});return d},_initProgressObject:function(c){var d={loaded:0,total:0,bitrate:0};if(c._progress){a.extend(c._progress,d)}else{c._progress=d}},_initResponseObject:function(c){var d;if(c._response){for(d in c._response){if(c._response.hasOwnProperty(d)){delete c._response[d]}}}else{c._response={}}},_onProgress:function(d,c){if(d.lengthComputable){var g=((Date.now)?Date.now():(new Date()).getTime()),f;if(c._time&&c.progressInterval&&(g-c._time<c.progressInterval)&&d.loaded!==d.total){return}c._time=g;f=Math.floor(d.loaded/d.total*(c.chunkSize||c._progress.total))+(c.uploadedBytes||0);this._progress.loaded+=(f-c._progress.loaded);this._progress.bitrate=this._bitrateTimer.getBitrate(g,this._progress.loaded,c.bitrateInterval);c._progress.loaded=c.loaded=f;c._progress.bitrate=c.bitrate=c._bitrateTimer.getBitrate(g,f,c.bitrateInterval);this._trigger("progress",a.Event("progress",{delegatedEvent:d}),c);this._trigger("progressall",a.Event("progressall",{delegatedEvent:d}),this._progress)}},_initProgressListener:function(c){var d=this,e=c.xhr?c.xhr():a.ajaxSettings.xhr();if(e.upload){a(e.upload).bind("progress",function(f){var g=f.originalEvent;f.lengthComputable=g.lengthComputable;f.loaded=g.loaded;f.total=g.total;d._onProgress(f,c)});c.xhr=function(){return e}}},_isInstanceOf:function(d,c){return Object.prototype.toString.call(c)==="[object "+d+"]"},_initXHRData:function(f){var h=this,d,c=f.files[0],e=f.multipart||!a.support.xhrFileUpload,g=a.type(f.paramName)==="array"?f.paramName[0]:f.paramName;f.headers=a.extend({},f.headers);if(f.contentRange){f.headers["Content-Range"]=f.contentRange}if(!e||f.blob||!this._isInstanceOf("File",c)){f.headers["Content-Disposition"]='attachment; filename="'+encodeURI(c.name)+'"'}if(!e){f.contentType=c.type||"application/octet-stream";f.data=f.blob||c}else{if(a.support.xhrFormDataFileUpload){if(f.postMessage){d=this._getFormData(f);if(f.blob){d.push({name:g,value:f.blob})}else{a.each(f.files,function(j,i){d.push({name:(a.type(f.paramName)==="array"&&f.paramName[j])||g,value:i})})}}else{if(h._isInstanceOf("FormData",f.formData)){d=f.formData}else{d=new FormData();a.each(this._getFormData(f),function(j,i){d.append(i.name,i.value)})}if(f.blob){d.append(g,f.blob,c.name)}else{a.each(f.files,function(j,i){if(h._isInstanceOf("File",i)||h._isInstanceOf("Blob",i)){d.append((a.type(f.paramName)==="array"&&f.paramName[j])||g,i,i.uploadName||i.name)}})}}f.data=d}}f.blob=null},_initIframeSettings:function(c){var d=a("<a></a>").prop("href",c.url).prop("host");c.dataType="iframe "+(c.dataType||"");c.formData=this._getFormData(c);if(c.redirect&&d&&d!==location.host){c.formData.push({name:c.redirectParamName||"redirect",value:c.redirect})}},_initDataSettings:function(c){if(this._isXHRUpload(c)){if(!this._chunkedUpload(c,true)){if(!c.data){this._initXHRData(c)}this._initProgressListener(c)}if(c.postMessage){c.dataType="postmessage "+(c.dataType||"")}}else{this._initIframeSettings(c)}},_getParamName:function(d){var c=a(d.fileInput),e=d.paramName;if(!e){e=[];c.each(function(){var g=a(this),h=g.prop("name")||"files[]",f=(g.prop("files")||[1]).length;while(f){e.push(h);f-=1}});if(!e.length){e=[c.prop("name")||"files[]"]}}else{if(!a.isArray(e)){e=[e]}}return e},_initFormSettings:function(c){if(!c.form||!c.form.length){c.form=a(c.fileInput.prop("form"));if(!c.form.length){c.form=a(this.options.fileInput.prop("form"))}}c.paramName=this._getParamName(c);if(!c.url){c.url=c.form.prop("action")||location.href}c.type=(c.type||(a.type(c.form.prop("method"))==="string"&&c.form.prop("method"))||"").toUpperCase();if(c.type!=="POST"&&c.type!=="PUT"&&c.type!=="PATCH"){c.type="POST"}if(!c.formAcceptCharset){c.formAcceptCharset=c.form.attr("accept-charset")}},_getAJAXSettings:function(c){var d=a.extend({},this.options,c);this._initFormSettings(d);this._initDataSettings(d);return d},_getDeferredState:function(c){if(c.state){return c.state()}if(c.isResolved()){return"resolved"}if(c.isRejected()){return"rejected"}return"pending"},_enhancePromise:function(c){c.success=c.done;c.error=c.fail;c.complete=c.always;return c},_getXHRPromise:function(g,d,c){var e=a.Deferred(),f=e.promise();d=d||this.options.context||f;if(g===true){e.resolveWith(d,c)}else{if(g===false){e.rejectWith(d,c)}}f.abort=e.promise;return this._enhancePromise(f)},_addConvenienceMethods:function(d,c){var g=this,f=function(e){return a.Deferred().resolveWith(g,e).promise()};c.process=function(h,e){if(h||e){c._processQueue=this._processQueue=(this._processQueue||f([this])).pipe(function(){if(c.errorThrown){return a.Deferred().rejectWith(g,[c]).promise()}return f(arguments)}).pipe(h,e)}return this._processQueue||f([this])};c.submit=function(){if(this.state()!=="pending"){c.jqXHR=this.jqXHR=(g._trigger("submit",a.Event("submit",{delegatedEvent:d}),this)!==false)&&g._onSend(d,this)}return this.jqXHR||g._getXHRPromise()};c.abort=function(){if(this.jqXHR){return this.jqXHR.abort()}this.errorThrown="abort";g._trigger("fail",null,this);return g._getXHRPromise(false)};c.state=function(){if(this.jqXHR){return g._getDeferredState(this.jqXHR)}if(this._processQueue){return g._getDeferredState(this._processQueue)}};c.processing=function(){return !this.jqXHR&&this._processQueue&&g._getDeferredState(this._processQueue)==="pending"};c.progress=function(){return this._progress};c.response=function(){return this._response}},_getUploadedBytes:function(c){var e=c.getResponseHeader("Range"),d=e&&e.split("-"),f=d&&d.length>1&&parseInt(d[1],10);return f&&f+1},_chunkedUpload:function(h,k){h.uploadedBytes=h.uploadedBytes||0;var l=this,d=h.files[0],e=d.size,m=h.uploadedBytes,g=h.maxChunkSize||e,j=this._blobSlice,c=a.Deferred(),i=c.promise(),f,n;if(!(this._isXHRUpload(h)&&j&&(m||g<e))||h.data){return false}if(k){return true}if(m>=e){d.error=h.i18n("uploadedBytes");return this._getXHRPromise(false,h.context,[null,"error",d.error])}n=function(){var q=a.extend({},h),p=q._progress.loaded;q.blob=j.call(d,m,m+g,d.type);q.chunkSize=q.blob.size;q.contentRange="bytes "+m+"-"+(m+q.chunkSize-1)+"/"+e;l._initXHRData(q);l._initProgressListener(q);f=((l._trigger("chunksend",null,q)!==false&&a.ajax(q))||l._getXHRPromise(false,q.context)).done(function(r,s,o){m=l._getUploadedBytes(o)||(m+q.chunkSize);if(p+q.chunkSize-q._progress.loaded){l._onProgress(a.Event("progress",{lengthComputable:true,loaded:m-q.uploadedBytes,total:m-q.uploadedBytes}),q)}h.uploadedBytes=q.uploadedBytes=m;q.result=r;q.textStatus=s;q.jqXHR=o;l._trigger("chunkdone",null,q);l._trigger("chunkalways",null,q);if(m<e){n()}else{c.resolveWith(q.context,[r,s,o])}}).fail(function(r,s,o){q.jqXHR=r;q.textStatus=s;q.errorThrown=o;l._trigger("chunkfail",null,q);l._trigger("chunkalways",null,q);c.rejectWith(q.context,[r,s,o])})};this._enhancePromise(i);i.abort=function(){return f.abort()};n();return i},_beforeSend:function(d,c){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer();this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(c);this._initProgressObject(c);c._progress.loaded=c.loaded=c.uploadedBytes||0;c._progress.total=c.total=this._getTotal(c.files)||1;c._progress.bitrate=c.bitrate=0;this._active+=1;this._progress.loaded+=c.loaded;this._progress.total+=c.total},_onDone:function(f,g,c,d){var h=d._progress.total,e=d._response;if(d._progress.loaded<h){this._onProgress(a.Event("progress",{lengthComputable:true,loaded:h,total:h}),d)}e.result=d.result=f;e.textStatus=d.textStatus=g;e.jqXHR=d.jqXHR=c;this._trigger("done",null,d)},_onFail:function(d,g,c,e){var f=e._response;if(e.recalculateProgress){this._progress.loaded-=e._progress.loaded;this._progress.total-=e._progress.total}f.jqXHR=e.jqXHR=d;f.textStatus=e.textStatus=g;f.errorThrown=e.errorThrown=c;this._trigger("fail",null,e)},_onAlways:function(d,f,c,e){this._trigger("always",null,e)},_onSend:function(f,d){if(!d.submit){this._addConvenienceMethods(f,d)}var l=this,g,c,k,i,h=l._getAJAXSettings(d),j=function(){l._sending+=1;h._bitrateTimer=new l._BitrateTimer();g=g||(((c||l._trigger("send",a.Event("send",{delegatedEvent:f}),h)===false)&&l._getXHRPromise(false,h.context,c))||l._chunkedUpload(h)||a.ajax(h)).done(function(m,n,e){l._onDone(m,n,e,h)}).fail(function(m,n,e){l._onFail(m,n,e,h)}).always(function(m,o,e){l._onAlways(m,o,e,h);l._sending-=1;l._active-=1;if(h.limitConcurrentUploads&&h.limitConcurrentUploads>l._sending){var n=l._slots.shift();while(n){if(l._getDeferredState(n)==="pending"){n.resolve();break}n=l._slots.shift()}}if(l._active===0){l._trigger("stop")}});return g};this._beforeSend(f,h);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){k=a.Deferred();this._slots.push(k);i=k.pipe(j)}else{this._sequence=this._sequence.pipe(j,j);i=this._sequence}i.abort=function(){c=[undefined,"abort","abort"];if(!g){if(k){k.rejectWith(h.context,c)}return j()}return g.abort()};return this._enhancePromise(i)}return j()},_onAdd:function(f,d){var v=this,u=true,p=a.extend({},this.options,d),g=d.files,k=g.length,n=p.limitMultiFileUploads,o=p.limitMultiFileUploadSize,q=p.limitMultiFileUploadSizeOverhead,c=0,r=this._getParamName(p),s,t,h,l,m=0;if(o&&(!k||g[0].size===undefined)){o=undefined}if(!(p.singleFileUploads||n||o)||!this._isXHRUpload(p)){h=[g];s=[r]}else{if(!(p.singleFileUploads||o)&&n){h=[];s=[];for(l=0;l<k;l+=n){h.push(g.slice(l,l+n));t=r.slice(l,l+n);if(!t.length){t=r}s.push(t)}}else{if(!p.singleFileUploads&&o){h=[];s=[];for(l=0;l<k;l=l+1){c+=g[l].size+q;if(l+1===k||((c+g[l+1].size+q)>o)||(n&&l+1-m>=n)){h.push(g.slice(m,l+1));t=r.slice(m,l+1);if(!t.length){t=r}s.push(t);m=l+1;c=0}}}else{s=r}}}d.originalFiles=g;a.each(h||g,function(i,e){var j=a.extend({},d);j.files=h?e:[e];j.paramName=s[i];v._initResponseObject(j);v._initProgressObject(j);v._addConvenienceMethods(f,j);u=v._trigger("add",a.Event("add",{delegatedEvent:f}),j);return u});return u},_replaceFileInput:function(c){var d=c.fileInput,e=d.clone(true);c.fileInputClone=e;a("<form></form>").append(e)[0].reset();d.after(e).detach();a.cleanData(d.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(g,f){if(f===d[0]){return e[0]}return f});if(d[0]===this.element[0]){this.element=e}},_handleFileTreeEntry:function(f,h){var k=this,c=a.Deferred(),g=function(l){if(l&&!l.entry){l.entry=f}c.resolve([l])},j=function(l){k._handleFileTreeEntries(l,h+f.name+"/").done(function(m){c.resolve(m)}).fail(g)},i=function(){d.readEntries(function(l){if(!l.length){j(e)}else{e=e.concat(l);i()}},g)},d,e=[];h=h||"";if(f.isFile){if(f._file){f._file.relativePath=h;c.resolve(f._file)}else{f.file(function(l){l.relativePath=h;c.resolve(l)},g)}}else{if(f.isDirectory){d=f.createReader();i()}else{c.resolve([])}}return c.promise()},_handleFileTreeEntries:function(c,d){var e=this;return a.when.apply(a,a.map(c,function(f){return e._handleFileTreeEntry(f,d)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(c){c=c||{};var d=c.items;if(d&&d.length&&(d[0].webkitGetAsEntry||d[0].getAsEntry)){return this._handleFileTreeEntries(a.map(d,function(f){var e;if(f.webkitGetAsEntry){e=f.webkitGetAsEntry();if(e){e._file=f.getAsFile()}return e}return f.getAsEntry()}))}return a.Deferred().resolve(a.makeArray(c.files)).promise()},_getSingleFileInputFiles:function(d){d=a(d);var c=d.prop("webkitEntries")||d.prop("entries"),e,f;if(c&&c.length){return this._handleFileTreeEntries(c)}e=a.makeArray(d.prop("files"));if(!e.length){f=d.prop("value");if(!f){return a.Deferred().resolve([]).promise()}e=[{name:f.replace(/^.*\\/,"")}]}else{if(e[0].name===undefined&&e[0].fileName){a.each(e,function(h,g){g.name=g.fileName;g.size=g.fileSize})}}return a.Deferred().resolve(e).promise()},_getFileInputFiles:function(c){if(!(c instanceof a)||c.length===1){return this._getSingleFileInputFiles(c)}return a.when.apply(a,a.map(c,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(d){var f=this,c={fileInput:a(d.target),form:a(d.target.form)};this._getFileInputFiles(c.fileInput).always(function(e){c.files=e;if(f.options.replaceFileInput){f._replaceFileInput(c)}if(f._trigger("change",a.Event("change",{delegatedEvent:d}),c)!==false){f._onAdd(d,c)}})},_onPaste:function(d){var f=d.originalEvent&&d.originalEvent.clipboardData&&d.originalEvent.clipboardData.items,c={files:[]};if(f&&f.length){a.each(f,function(g,h){var e=h.getAsFile&&h.getAsFile();if(e){c.files.push(e)}});if(this._trigger("paste",a.Event("paste",{delegatedEvent:d}),c)!==false){this._onAdd(d,c)}}},_onDrop:function(f){f.dataTransfer=f.originalEvent&&f.originalEvent.dataTransfer;var g=this,d=f.dataTransfer,c={};if(d&&d.files&&d.files.length){f.preventDefault();this._getDroppedFiles(d).always(function(e){c.files=e;if(g._trigger("drop",a.Event("drop",{delegatedEvent:f}),c)!==false){g._onAdd(f,c)}})}},_onDragOver:b("dragover"),_onDragEnter:b("dragenter"),_onDragLeave:b("dragleave"),_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave});this._on(this.options.pasteZone,{paste:this._onPaste})}if(a.support.fileInput){this._on(this.options.fileInput,{change:this._onChange})}},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(c,e){var d=a.inArray(c,this._specialOptions)!==-1;if(d){this._destroyEventHandlers()}this._super(c,e);if(d){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var c=this.options;if(c.fileInput===undefined){c.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]')}else{if(!(c.fileInput instanceof a)){c.fileInput=a(c.fileInput)}}if(!(c.dropZone instanceof a)){c.dropZone=a(c.dropZone)}if(!(c.pasteZone instanceof a)){c.pasteZone=a(c.pasteZone)}},_getRegExp:function(e){var d=e.split("/"),c=d.pop();d.shift();return new RegExp(d.join("/"),c)},_isRegExpOption:function(c,d){return c!=="url"&&a.type(d)==="string"&&/^\/.*\/[igm]{0,3}$/.test(d)},_initDataAttributes:function(){var e=this,d=this.options,c=a(this.element[0].cloneNode(false));a.each(c.data(),function(g,h){var f="data-"+g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();if(c.attr(f)){if(e._isRegExpOption(g,h)){h=e._getRegExp(h)}d[g]=h}})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(c){var d=this;if(!c||this.options.disabled){return}if(c.fileInput&&!c.files){this._getFileInputFiles(c.fileInput).always(function(e){c.files=e;d._onAdd(null,c)})}else{c.files=a.makeArray(c.files);this._onAdd(null,c)}},send:function(d){if(d&&!this.options.disabled){if(d.fileInput&&!d.files){var h=this,e=a.Deferred(),g=e.promise(),f,c;g.abort=function(){c=true;if(f){return f.abort()}e.reject(null,"abort","abort");return g};this._getFileInputFiles(d.fileInput).always(function(i){if(c){return}if(!i.length){e.reject();return}d.files=i;f=h._onSend(null,d);f.then(function(k,l,j){e.resolve(k,l,j)},function(k,l,j){e.reject(k,l,j)})});return this._enhancePromise(g)}d.files=a.makeArray(d.files);if(d.files.length){return this._onSend(null,d)}}return this._getXHRPromise(false,d&&d.context)}})}));