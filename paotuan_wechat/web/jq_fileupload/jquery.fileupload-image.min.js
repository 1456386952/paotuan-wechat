(function(a){if(typeof define==="function"&&define.amd){define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],a)}else{a(window.jQuery,window.loadImage)}}(function(a,b){a.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:true,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"});a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:10000000,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:false,imageCrop:false,disableImageResize:true,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:true,previewThumbnail:true,previewCrop:false,previewCanvas:true},processActions:{loadImage:function(c,f){if(f.disabled){return c}var g=this,e=c.files[c.index],d=a.Deferred();if((a.type(f.maxFileSize)==="number"&&e.size>f.maxFileSize)||(f.fileTypes&&!f.fileTypes.test(e.type))||!b(e,function(h){if(h.src){c.img=h}d.resolveWith(g,[c])},f)){return c}return d.promise()},resizeImage:function(c,f){if(f.disabled||!(c.canvas||c.img)){return c}f=a.extend({canvas:true},f);var h=this,d=a.Deferred(),e=(f.canvas&&c.canvas)||c.img,g=function(j){if(j&&(j.width!==e.width||j.height!==e.height||f.forceResize)){c[j.getContext?"canvas":"img"]=j}c.preview=j;d.resolveWith(h,[c])},i;if(c.exif){if(f.orientation===true){f.orientation=c.exif.get("Orientation")}if(f.thumbnail){i=c.exif.get("Thumbnail");if(i){b(i,g,f);return d.promise()}}if(c.orientation){delete f.orientation}else{c.orientation=f.orientation}}if(e){g(b.scale(e,f));return d.promise()}return c},saveImage:function(c,f){if(!c.canvas||f.disabled){return c}var g=this,e=c.files[c.index],d=a.Deferred();if(c.canvas.toBlob){c.canvas.toBlob(function(h){if(!h.name){if(e.type===h.type){h.name=e.name}else{if(e.name){h.name=e.name.replace(/\..+$/,"."+h.type.substr(6))}}}if(e.type!==h.type){delete c.imageHead}c.files[c.index]=h;d.resolveWith(g,[c])},f.type||e.type,f.quality)}else{return c}return d.promise()},loadImageMetaData:function(c,e){if(e.disabled){return c}var f=this,d=a.Deferred();b.parseMetaData(c.files[c.index],function(g){a.extend(c,g);d.resolveWith(f,[c])},e);return d.promise()},saveImageMetaData:function(d,f){if(!(d.imageHead&&d.canvas&&d.canvas.toBlob&&!f.disabled)){return d}var e=d.files[d.index],c=new Blob([d.imageHead,this._blobSlice.call(e,20)],{type:e.type});c.name=e.name;d.files[d.index]=c;return d},setImage:function(c,d){if(c.preview&&!d.disabled){c.files[c.index][d.name||"preview"]=c.preview}return c},deleteImageReferences:function(c,d){if(!d.disabled){delete c.img;delete c.canvas;delete c.preview;delete c.imageHead}return c}}})}));